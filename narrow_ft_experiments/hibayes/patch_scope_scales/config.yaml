model:
  models:
    - name: ordered_logistic_model
      config:
        tag: patch_scope_scales_effects_grader_model
        main_effects: ["grader_model_id", "model", "organism_type", "layer", "position"]
        num_classes: 10  # coarse 0-9 bins (3 original scales per bin)
        effect_coding_for_main_effects: true

        # More regularising priors to stabilise the ordered logistic geometry
        # prior_intercept_loc: 0.0
        # prior_intercept_scale: 0.5
        # prior_main_effects_loc: 0.0
        # prior_main_effects_scale: 0.3
        # prior_first_cutpoint_loc: -2.0
        # prior_first_cutpoint_scale: 0.5
        # prior_cutpoint_diffs_loc: -1.0
        # prior_cutpoint_diffs_scale: 0.2
        # min_cutpoint_spacing: 0.1

      # fit:
      #   target_accept: 0.99
      #   max_tree_depth: 15
      #   warmup: 4000
      #   samples: 4000

# Original fine-grained scales:
# [0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9,
#  2.0, 3.0, 4.0, 5.0, 10.0, 20.0, 40.0, 60.0, 80.0, 100.0, 120.0, 140.0, 160.0,
#  180.0, 200.0]

data_process:
  processors:
    - extract_observed_feature: {feature_name: best_scale_bin}
    - extract_features:
        categorical_features:
          [
            model,
            organism,
            organism_type,
            layer,
            dataset_dir,
            position,
            grader_model_id,
          ]


check:
  checkers:
    # - prior_predictive_plot
    - divergences
    - r_hat
    - ess_bulk
    - ess_tail
    # - posterior_predictive_plot
    - waic



# communicate:
#   path: narrow_ft_experiments/hibayes/patch_scope_scales/custom.py
#   communicators:
#     - model_comparison_plot: {ic: waic}
#     - model_comparison_plot: {ic: loo}


